<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Changelog</title>
    <script type="module" src="https://md-block.verou.me/md-block.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <input type="file" id="file-input" />
    
    <hr />

    <md-block></md-block>

    <div></div>

    <script type="text/javascript">
        // var mdBlock = document.querySelector("md-block");
        var mdBlock = document.querySelector("div");
        var input = document.getElementById("file-input");
        var reader = new FileReader();

        // input.addEventListener("change", () => {
        //     let file = input.files[0];
        //     // reader.readAsDataURL(file);
        //     reader.readAsArrayBuffer(file);
        // });

        const dataTransfer = new DataTransfer();
        
        const myFile = new File(['Hello World!'], 'CHANGELOG.md', {
            type: 'text/plain',
            lastModified: new Date(),
        });

        dataTransfer.items.add(myFile);
        input.files = dataTransfer.files;

        let file = input.files[0];
        reader.readAsArrayBuffer(file);

        reader.addEventListener("load", async () => {
            let decoder = new TextDecoder("utf-8");
            let text = decoder.decode(reader.result);

            // document.write(text);
            let rawText = await text.replace(/(?:\r\n|\r|\n)/g, '<br/>')
            await rawText.split('<br/>').map((item) => {
                if (item.includes('#')) {
                    if (item.includes('###')) {
                        let header = item.split('###');
                        let headerLevel = header[0].length;
                        let headerText = header[1];
                        rawText = rawText.replaceAll(item, `<h3>${headerText}</h3>`);
                    }

                    let header = item.split('#');
                    let headerLevel = header[0].length;
                    let headerText = header[1];
                    rawText = rawText.replaceAll(item, `<h1>${headerText}</h1>`);
                }


                if (item.includes('```')) {
                    let code = item.split('```');
                    let codeText = code[1];
                    rawText = rawText.replaceAll(item, `<code>${codeText}</code>`);
                }

                if (item.includes('**')) {
                    let bold = item.split('**');
                    let boldText = bold[1];
                    rawText = rawText.replaceAll(item, `<b>${boldText}</b>`);
                }

                if (item.includes('*')) {
                    let italic = item.split('*');
                    let italicText = italic[1];
                    rawText = rawText.replaceAll(item, `<i>${italicText}</i>`);
                }
            })
            mdBlock.innerHTML = rawText;

            //copy to clipboard
            navigator.clipboard.writeText(rawText).then(function() {
                console.log('Async: Copying to clipboard was successful!');
            }, function(err) {
                console.error('Async: Could not copy text: ', err);
            });
        });
    </script>
</body>
</html>